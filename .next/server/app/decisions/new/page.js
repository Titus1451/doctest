(()=>{var e={};e.id=58,e.ids=[58],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},629:e=>{"use strict";e.exports=require("fs/promises")},5315:e=>{"use strict";e.exports=require("path")},9026:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),t(7803),t(3585),t(5866);var i=t(3191),a=t(8716),r=t(7922),n=t.n(r),l=t(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(s,o);let c=["",{children:["decisions",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,7803)),"/Users/titusay/Coding Projects/doctest/app/decisions/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,3585)),"/Users/titusay/Coding Projects/doctest/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/titusay/Coding Projects/doctest/app/decisions/new/page.tsx"],u="/decisions/new/page",p={require:t,loadChunk:()=>Promise.resolve()},m=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/decisions/new/page",pathname:"/decisions/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5660:(e,s,t)=>{let i={a27334549c40f73d31efc77c023d42e0a2848918:()=>Promise.resolve().then(t.bind(t,5724)).then(e=>e.createDecision)};async function a(e,...s){return(await i[e]()).apply(null,s)}e.exports={a27334549c40f73d31efc77c023d42e0a2848918:a.bind(null,"a27334549c40f73d31efc77c023d42e0a2848918")}},1849:(e,s,t)=>{Promise.resolve().then(t.bind(t,2718)),Promise.resolve().then(t.bind(t,3104))},2718:(e,s,t)=>{"use strict";t.d(s,{DecisionForm:()=>m});var i=t(326),a=t(7577),r=t(7863);t(5424);var n=(0,t(6242).$)("a27334549c40f73d31efc77c023d42e0a2848918"),l=t(772),o=t(4432),c=t(7673),d=t(1048),u=t(962);function p(){let{pending:e}=(0,u.useFormStatus)();return i.jsx(l.z,{type:"submit",disabled:e,children:e?"Saving...":"Save Decision"})}function m({jurisdictions:e}){let[s,t]=a.useState([]),[u,m]=a.useState(""),[x,h]=a.useState([]),[f,j]=a.useState(!1),[v,g]=a.useState([]),y=a.useRef(null),b=e=>{t(s.filter(s=>s!==e))},w=e=>{x.includes(e)?h(x.filter(s=>s!==e)):h([...x,e])},N=e=>{g(v.filter((s,t)=>t!==e))},P=async e=>{v.forEach(s=>{e.append("files",s)}),s.forEach(s=>{e.append("links",s)}),x.forEach(s=>{e.append("jurisdictions",s)}),await n(e)};return(0,i.jsxs)("form",{action:P,className:"space-y-6 max-w-2xl bg-white p-8 rounded-xl border shadow-sm",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{htmlFor:"title",children:"Title"}),i.jsx(o.I,{id:"title",name:"title",placeholder:"e.g. VAT treatment of digital services 2024",required:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{htmlFor:"summary",children:"Summary"}),i.jsx(o.I,{id:"summary",name:"summary",placeholder:"Brief overview of the decision",required:!0})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{children:"Jurisdictions"}),(0,i.jsxs)("div",{className:"relative group",children:[i.jsx("div",{className:"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-slate-200 bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-white placeholder:text-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-950 disabled:cursor-not-allowed disabled:opacity-50 cursor-pointer",children:i.jsx("span",{className:"truncate",children:x.length>0?x.join(", "):"Select jurisdictions..."})}),i.jsx("div",{className:"absolute top-full left-0 z-50 w-full min-w-[8rem] overflow-hidden rounded-md border bg-white text-slate-950 shadow-md animate-in fade-in-0 zoom-in-95 hidden group-hover:block hover:block",children:i.jsx("div",{className:"max-h-64 overflow-y-auto p-1",children:e.map(e=>(0,i.jsxs)("div",{className:(0,r.cn)("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-slate-100 hover:text-slate-900",x.includes(e.code)&&"bg-slate-50 font-medium"),onClick:()=>w(e.code),children:[i.jsx("div",{className:(0,r.cn)("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-slate-300",x.includes(e.code)?"bg-slate-900 border-slate-900 text-white":"bg-transparent"),children:x.includes(e.code)&&i.jsx("span",{className:"h-2 w-2 bg-current rounded-sm"})}),(0,i.jsxs)("span",{children:[e.name," ",(0,i.jsxs)("span",{className:"text-xs text-slate-400 ml-1",children:["(",e.code,")"]})]})]},e.id))})})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{htmlFor:"taxType",children:"Tax Type"}),f?(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx(o.I,{id:"taxType",name:"taxType",placeholder:"Enter custom tax type...",autoFocus:!0}),i.jsx(l.z,{type:"button",variant:"ghost",size:"icon",onClick:()=>j(!1),title:"Back to list",children:"âœ•"})]}):(0,i.jsxs)("select",{id:"taxTypeSelect",className:"flex h-9 w-full rounded-md border border-slate-200 bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-slate-950",onChange:e=>{"CUSTOM_PLUS"===e.target.value&&j(!0)},name:f?void 0:"taxType",defaultValue:"",children:[i.jsx("option",{value:"",disabled:!0,children:"Select Tax Type..."}),i.jsx("option",{value:"Sales Tax",children:"Sales Tax"}),i.jsx("option",{value:"Meals Tax",children:"Meals Tax"}),i.jsx("option",{value:"Alcohol Tax",children:"Alcohol Tax"}),i.jsx("option",{value:"CUSTOM_PLUS",children:"+ Add Custom"})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{htmlFor:"status",children:"Status"}),(0,i.jsxs)("select",{id:"status",name:"status",className:"flex h-9 w-full rounded-md border border-slate-200 bg-transparent px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-slate-950",children:[i.jsx("option",{value:"DRAFT",children:"Draft"}),i.jsx("option",{value:"FINAL",children:"Final"}),i.jsx("option",{value:"DEPRECATED",children:"Deprecated"})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{htmlFor:"rationale",children:"Rationale & Reasoning"}),i.jsx(c.g,{id:"rationale",name:"rationale",className:"min-h-[200px]",placeholder:"Detailed explanation of the decision, references to laws, etc.",required:!0})]}),(0,i.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[i.jsx("h3",{className:"font-medium text-slate-900",children:"Supporting Evidence"}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{children:"Upload Files (PDF, Images, Docs)"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx(l.z,{type:"button",variant:"secondary",onClick:()=>y.current?.click(),children:"Choose Files"}),i.jsx("input",{ref:y,type:"file",multiple:!0,className:"hidden",onChange:e=>{if(e.target.files&&e.target.files.length>0){let s=Array.from(e.target.files);g(e=>[...e,...s]),y.current&&(y.current.value="")}}})]}),v.length>0&&i.jsx("div",{className:"space-y-2 mt-2",children:v.map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-slate-50 rounded text-sm",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[i.jsx("span",{className:"font-medium text-slate-700 truncate",children:e.name}),(0,i.jsxs)("span",{className:"text-xs text-slate-400",children:["(",(e.size/1024).toFixed(1)," KB)"]})]}),i.jsx("button",{type:"button",onClick:()=>N(s),className:"text-red-500 hover:text-red-700 ml-2",children:"Remove"})]},s))})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx(d._,{children:"External Links"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx(o.I,{value:u,onChange:e=>m(e.target.value),placeholder:"https://...",type:"url"}),i.jsx(l.z,{type:"button",onClick:()=>{u&&!s.includes(u)&&(t([...s,u]),m(""))},variant:"secondary",children:"Add"})]}),s.length>0&&i.jsx("div",{className:"space-y-2 mt-2",children:s.map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-slate-50 rounded text-sm",children:[i.jsx("span",{className:"truncate flex-1",children:e}),i.jsx("button",{type:"button",onClick:()=>b(e),className:"text-red-500 hover:text-red-700 ml-2",children:"Remove"})]},s))})]})]}),(0,i.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[i.jsx(l.z,{variant:"outline",type:"button",onClick:()=>window.history.back(),children:"Cancel"}),i.jsx(p,{})]})]})}},5724:(e,s,t)=>{"use strict";t.r(s),t.d(s,{createDecision:()=>c});var i=t(7745);t(6461);var a=t(8296),r=t(207),n=t(4739),l=t(629),o=t(5315);async function c(e){let s=e.get("title"),t=e.get("summary"),i=e.get("rationale"),c=e.get("status"),d=e.get("taxType"),u=e.getAll("links"),p=e.getAll("files"),m=[];for(let e of u)e&&""!==e.trim()&&m.push({fileName:e,fileUrl:e,fileType:"LINK",notes:"External Link"});if(p&&p.length>0){let e=(0,o.join)(process.cwd(),"public/uploads");try{await (0,l.mkdir)(e,{recursive:!0})}catch(e){}for(let s of p){if(0===s.size)continue;let t=await s.arrayBuffer(),i=Buffer.from(t),a=`${Date.now()}-${s.name.replace(/\s/g,"-")}`,r=(0,o.join)(e,a);await (0,l.writeFile)(r,i),m.push({fileName:s.name,fileUrl:`/uploads/${a}`,fileType:s.type,notes:"Uploaded during creation"})}}let x=e.getAll("jurisdictions"),h=await a.db.user.findUnique({where:{email:"admin@company.com"}});await a.db.decision.create({data:{title:s,summary:t,rationale:i,status:c||"DRAFT",taxType:d,author:h?{connect:{id:h.id}}:void 0,jurisdictions:{connect:x.map(e=>({code:e}))},evidence:{create:m}}}),(0,r.revalidatePath)("/decisions"),(0,n.redirect)("/decisions")}(0,t(5723).h)([c]),(0,i.j)("a27334549c40f73d31efc77c023d42e0a2848918",c)},7803:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var i=t(9510),a=t(8585);let r=(0,t(8570).createProxy)(String.raw`/Users/titusay/Coding Projects/doctest/components/decisions/DecisionForm.tsx#DecisionForm`);var n=t(9487);async function l(){let e=await n.db.jurisdiction.findMany({orderBy:{name:"asc"}});return(0,i.jsxs)("div",{children:[i.jsx(a.h,{title:"New Decision"}),i.jsx("div",{className:"p-8",children:i.jsx(r,{jurisdictions:e})})]})}},9487:(e,s,t)=>{"use strict";t.d(s,{db:()=>a});var i=t(3524);let a=globalThis.prisma||new i.PrismaClient}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),i=s.X(0,[276,774,19,297],()=>t(9026));module.exports=i})();